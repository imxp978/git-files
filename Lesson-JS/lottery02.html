<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bootstrap demo</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />

    <style>

      * {
        bor/der: 1px dotted black;
      }

      table {
        bor/der: 1px dotted black;
      }

      body {
        background-color: orange;
        font-family:  sans-serif;
        padding-top: 2%;
        border: 1px dotted black;
        line-height: 2em;
      }

      label {
        padding-right: 10px;
      }
      .container {
        width: 66%;
        padding: 30px;
        background-color: #ffff;
        border-radius: 30px;
        overflow: hidden;
        margin: 20px auto;
      }

      table.border-primary td {
        wi/dth: 50%;
      }

      .coin1 {
        position: absolute;
        /* https://developer.mozilla.org/zh-CN/docs/Web/CSS/position */
        height: 200px;
        top: -200px;
        left: 17%;
        transition: 0.9s;
        
        /* animation: 時長 速度軌跡 重複次數 動畫方向 動畫名稱 */
        /* https://developer.mozilla.org/zn-CN/docs/Web/CSS/animation */
      }
      
      .coin2 {
        position: absolute;
        height: 300px;
        top: -1300px;
        left: 33%;
        transition: 0.5s;
      }

      .coin3 {
        position: absolute;
        height: 150px;
        top: -2300px;
        left: 66%;
      }

      .coin4 {
        position: absolute;
        height: 180px;
        top: -500px;
        left: 75%;
      }

      .coin5 {
        position: absolute;
        height: 220px;
        top: -3000px;
        left: 54%;
      }

      @keyframes drop {
        from {
        }
        to {
          rotate: 720deg; 
          top: 100%; 
        }
      }
    </style>
  </head>

  <body>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"
    ></script>

    <div class="container">
      <div class="row">
        <table class="table table-borderless border-primary">
          <thead>
            <tr>
              <th colspan="2">
                <img
                  src="https://www.gogowinners.com/upload/lottery/539.png"
                  alt=""
                  class="mx-auto"
                  style="display: block; max-width: 30%"
                />
              </th>
            </tr>
            <tr>
              <th scope="col">選擇投注號</th>
              <th scope="col">遊戲介紹</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="width:33%">
                <div
                  id="wrap"
                  style="
                  
                    height: 250px;
                    display: flex;
                    flex-wrap: wrap;
                    align-content: space-around;
                  "
                ></div>
              </td>
              <td>
                <b>基本玩法</b><br />
                今彩539是一種樂透型遊戲，您必須從01~39的號碼中任選5個號碼進行投注。開獎時，開獎單位將隨機開出五個號碼，這一組號碼就是該期今彩539的中獎號碼，也稱為「獎號」。您的五個選號中，如有二個以上（含二個號碼）對中當期開出之五個號碼，即為中獎，並可依規定兌領獎金。各獎項的中獎方式如下表：
                <table class="table-bordered border-danger">
                  <tr>
                    <td>獎項</td>
                    <td>中獎方式</td>
                  </tr>
                  <tr>
                    <td>頭獎</td>
                    <td>與當期五個中獎號碼完全相同者</td>
                  </tr>
                  <tr>
                    <td>二獎</td>
                    <td>對中當期獎號之其中任四碼</td>
                  </tr>
                  <tr>
                    <td>三獎</td>
                    <td>對中當期獎號之其中任三碼</td>
                  </tr>
                  <tr>
                    <td>四獎</td>
                    <td>對中當期獎號之其中任二碼</td>
                  </tr>
                </table>
                <p>頭獎中獎率約1/58萬，總中獎率約1/9</p>
              </td>
            </tr>
            <tr>
              <td>
                <p>

                <button
                  type="button"
                  class="btn btn-success"
                  onclick="autoChoiceNewfromTeacher()"
                >
                  電腦選號(5個號碼)
                </button>
                <button
                  type="button"
                  class="btn btn-primary ms-2"
                  onclick="reset()"
                >
                  清除重選
                </button></p>
                <p>
                <button
                  type="button"
                  class="btn btn-danger"
                  onclick= openWinner()
                >
                  進行開獎
                </button></p>
              </td>
              <td>
                <b>獎金分配方式</b><br />
                雙贏彩所有獎項皆為固定獎項，各獎項金額如下：<br />
                <table class="table-bordered border-info">
                  <thead>
                    <tr>
                      <td>獎項</td>
                      <td>頭獎</td>
                      <td>二獎</td>
                      <td>三獎</td>
                      <td>四獎</td>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>單注獎金</td>
                      <td>$8,000,000</td>
                      <td>$20,000</td>
                      <td>$300</td>
                      <td>$50</td>
                    </tr>
                  </tbody>
                </table>
              </td>
            </tr>
            <tr>
              <td id="result"><br>投注號碼:<br>對中號碼: <br>中獎狀態:</td>
              <td id="winner">開獎號碼:</td>
            </tr>
          </tbody>
        </table>
      </div>
      <img class="coin1" src="https://www.mint.ca/globalassets/products/2023/l8/208123-dollar100-pure-gold-coin-lunar-year-dragon/208123_obv-1198.png">
      <img class="coin2" src="https://www.mint.ca/globalassets/products/2023/l8/208123-dollar100-pure-gold-coin-lunar-year-dragon/208123_obv-1198.png">
      <img class="coin3" src="https://www.mint.ca/globalassets/products/2023/l8/208123-dollar100-pure-gold-coin-lunar-year-dragon/208123_obv-1198.png">
      <img class="coin4" src="https://www.mint.ca/globalassets/products/2023/l8/208123-dollar100-pure-gold-coin-lunar-year-dragon/208123_obv-1198.png">
      <img class="coin5" src="https://www.mint.ca/globalassets/products/2023/l8/208123-dollar100-pure-gold-coin-lunar-year-dragon/208123_obv-1198.png">
    </div>
    <script src="comlib.js"></script>
    <script>

      var prize = {
        0: "未中獎",
        1: "未中獎",
        2: "四獎: 獎金$50",
        3: "三獎: 獎金$300",
        4: "二獎: 獎金$20,000",
        5: "頭獎: 獎金$8,000,000",
      }

      const color = {
        0: "",
        1: "",
        2: "red",
        3: "red",
        4: "red",
        5: "red",

      }
      
      var picked = [];
      const chk_arr = document.getElementsByName('chkRights[]');
      
      function reset () {
        for (let i = 0; i < 40; i++) {
          chk_arr[i].checked = false;
        }
        picked = [];
        pickedlist = "";
        winnerNumber = "";
        pickedlist = "";
        matchlist = "";
        winnerNumber = [];
        match = [];
        selected = [];

      }

      function autoChoice () {
        reset();
        for(let i = 0; i < 5; i++) {
          let number = rand(0,23);
          if (chk_arr[number].checked === false) {
            chk_arr[number].checked = true;
            console.log(number);
          } else {
            i--;
          }
        }
      }

      function render() {
        const wrap = document.querySelector("#wrap");
        for (let i = 1; i < 40; i++) {
          let j = i;
          j < 10 ? (j = "0" + j) : j;
          
          const div = document.createElement("div");
          div.classList.add("form-check", "form-check=inline");
          
          const input = document.createElement("input");
          input.classList.add("form-check-input");
          input.type = "checkbox";
          input.value = i;
          input.name = "chkRights[]";
          input.id = "Check" + i;
          
          const label = document.createElement("label");
          label.classList.add("form-check-label");
          label.setAttribute("for", "Check" + i);
          label.innerText = j;
          
          wrap.append(div);
          div.append(input, label);
        }
      }
      
      render();

      function autoChoiceNew () {
        for(let i = 0; i < 39; i++) {

          if ((chk_arr[i].checked === true) && (!picked.includes(i + 1))) {
            picked.push(i + 1);
          }
        }
        console.log('已勾選的array: '+ picked);

        while(picked.length < 5) {
            let r = rand(1,39);
            while (picked.includes(r)) {
               r = rand(1,39);
            }
            if (chk_arr[r].checked === false)  {
              chk_arr[r].checked = true;
              //console.log('r=' + (r));
              picked.push(r);
            }
            //console.log(picked);
        }
      }

      function autoChoiceNewfromTeacher () {
        //reset
        var count = 0;
        picked = [];
        selected = [];
        match = [];
        for(let i = 0; i <= 38; i++) {
          if (chk_arr[i].checked == true) {
            count ++;
          }
        }

        if (count >= 5) {
          alert('more than 5 number');
          return false;
        }

        for (let i = 0; i <= (4-count); i++) {
          let chkData = rand(0,38);
          if (chk_arr[chkData].checked == false) {
            chk_arr[chkData].checked = true;
            picked.push(chkData+1);
          } else {
            i--;
          }
        }
      }

      const coin1 = document.querySelector(".coin1");
      const coin2 = document.querySelector(".coin2");
      const coin3 = document.querySelector(".coin3");
      const coin4 = document.querySelector(".coin4");
      const coin5 = document.querySelector(".coin5");
      var selected = [];
      var match = [];

      function openWinner () {
        //reset
        match = [];
        selected = [];
        var winnerNumber = "";
        

        const winner = document.querySelector('#winner');
        const result = document.querySelector('#result');
        for (let i = 0; i < 5; i ++) {
          r = rand(1, 39);
          while(selected.includes(r)) {
            r = rand(1,39);
          }
          selected.push(r);
          winnerNumber += (r+", ");
          //console.log(winnerNumber);
        } 

        //console.log('unsorted: '+selected);
        selected.sort(function(a, b) {
          return a - b; // a - b > 0
        });

        //console.log('sorted: '+selected);
        var selectedSorted = selected;
        //console.log(selectedSorted);

        var winnerNumberSorted = "";
        for (let i = 0; i < selectedSorted.length; i++) { 
          winnerNumberSorted += (selectedSorted[i] + ", ")
        }
        
        let counter = 0;
        var pickedlist = "";
        //console.log('selected: ' + selected);
        //console.log('picked: ' + picked);
        for (let i = 0; i < 5; i++) {
          if (picked.includes(selected[i])) {
            counter ++;
            match.push(selected[i]);
          }
        }
        //console.log('中獎數: '+counter);
        //console.log(match);

        // check if win? coindrop
          coinDrop();
          
        

        for (let i = 0; i < picked.length; i++) {
          pickedlist += (picked[i] + ', ');
        }

        var matchlist = "";

        for (let i = 0; i < match.length; i++) {
          matchlist += (match[i] + ', ');
        }

        //console.log(prize[match.length]);

        //render and reset
        winner.innerHTML = '開獎號碼: ' + winnerNumber + '<br>排序號碼: ' + winnerNumberSorted ;
        result.innerHTML = '投注號碼: ' + pickedlist + '<br>對中獎號: ' + match.length + ' 個  中獎號碼: ' + matchlist + '<br>中獎狀態: ' + "<h3 style=\"color:" + color[match.length] + "\">" +prize[match.length] + "</h3>"; 

        winnerNumber = "";
        pickedlist = "";
        matchlist = "";
        winnerNumber = [];
        //picked = [];
        match = [];
        console.log(match.length);
      }
      
      function coinDrop() {
        //金幣個數
        let coins = 5;

        //reset animation
        for (let i = 1; i <= coins; i++) {
          const coin = document.querySelector(`.coin${i}`);
          coin.style.animation = "";
        }
        // start animation
        if (match.length > 1) {

          for (let j = 1; j <= coins; j++) {
            const coin = document.querySelector(`.coin${j}`);
            coin.style.animation = "1s linear infinite normal drop";
          }
        } 

      }


    </script>
  </body>
</html>
