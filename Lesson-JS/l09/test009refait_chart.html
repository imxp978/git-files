<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"
        integrity="sha256-QvgynZibb2U53SsVu98NggJXYqwRL7tg3FeyfXvPOUY=" crossorigin="anonymous"></script>
</head>

<body>
    <input id="people" type="number" placeholder="how many people" /><br />
    <input id="subjects" type="number" placeholder="how many subjects" /><br />
    <input id="submit" type="submit" value="submit" />
    <hr>

    <table id="sheet" border="1"></table>
    <hr>

    <div id="main" style="width:800px; height:600px;"></div>
    <hr>
    <div id="main1" style="width:800px; height:600px;"></div>
    <hr>
    <div id="main2" style="width:800px; height:600px;"></div>

    <script>
        function rand(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1) + min);
        }
    </script>
    <script>
        const submit = document.querySelector("#submit");

        let people, subjects;
        let scoreSheet = [];
        let avgArray = [];
        // objArray = [ {avg: original number}]
        let objArray = [];

        submit.addEventListener("click", function () {
            data();
        });

        function data() {
            scoreSheet = [];
            avgArray = [];
            objArray = [];
            const people_input = document.querySelector("#people");
            const subjects_input = document.querySelector("#subjects");
            people = parseInt(people_input.value);
            subjects = parseInt(subjects_input.value);

            if (!people || !subjects) {
                alert("Please enter valid values for people and subjects.");
                return;
            }

            for (let i = 0; i < people; i++) {
                // 要填入的是array, 所以要先宣告array中的array;
                scoreSheet.push([]);
                for (let j = 0; j < subjects; j++) {
                    scoreSheet[i][j] = rand(1, 100);
                }
                // console.log(scoreSheet);

                let sum = 0;
                let avg = 0;
                for (let j = 0; j < subjects; j++) {
                    sum += scoreSheet[i][j];
                }
                // console.log(sum);
                avg = (sum / subjects).toFixed(2);
                scoreSheet[i][subjects] = avg;
                avgArray[i] = avg;
                let object = {};
                object.key = avgArray[i];
                object.value = i + 1;
                objArray.push(object);
                // console.log(typeof(object.key));
            }
            sort(objArray);
            render();
        }

        function sort(array) {
            for (let i = 0; i < array.length; i++) {
                for (let j = 0; j < array.length - 1 - i; j++) {
                    let temp = 0;
                    if (parseFloat(array[j].key) < parseFloat(array[j + 1].key)) {
                        temp = array[j];
                        array[j] = array[j + 1];
                        array[j + 1] = temp;
                    }
                }
                for (let i = 0; i < people; i++) {
                    // scoreSheet[i][4] =
                    let rank = i + 1;
                    scoreSheet[objArray[i].value - 1][subjects + 1] = rank;
                }
            }
            // console.log(array);
        }

        function render() {
            const sheet = document.querySelector("#sheet");
            sheet.innerHTML = "";

            for (let i = 0; i < people; i++) {
                const tr = document.createElement("tr");
                // 科目+2 (平均&排名)
                for (let j = 0; j < subjects + 2; j++) {
                    const td = document.createElement("td");
                    td.textContent = scoreSheet[i][j];
                    if (j !== (subjects + 1)) {
                        if (parseInt(td.textContent) >= 95) {
                            td.textContent = '*' + td.textContent;
                            td.style.color = 'green';
                            td.style.fontWeight = 'bolder';
                        } else if (parseInt(td.textContent) >= 90 && parseInt(td.textContent) < 95) {
                            td.style.color = 'green';
                        } else if (parseInt(td.textContent) < 60) {
                            td.style.color = 'red';
                        }
                    }
                    tr.append(td);
                }
                sheet.append(tr);
                //charts();
            }
        }

        //charts
        function charts() {

            var statistics = []; // 確認每個科目都有初始直0
            var fail = [];

            for (let i = 0; i < subjects; i++) {
                statistics.push(0);
                fail.push(0);
            }

            for (let i = 0; i < people; i++) {
                for (let j = 0; j < subjects; j++) {
                    if (scoreSheet[i][j] < 60) {
                        fail[j - 1]++;
                    }
                    statistics[j - 1][scoreAssign(scoreSheet[i][j])]++;
                    total = total + scoreSheet[i][j];

                    const myChart = echarts.init(document.getElementById('main'));
                    console.log('subjects: ' + subjects);
                }
                let clist = [];
                for (let i = 0; i < subjects; i++) {
                    let subject = 'Subject' + (i + 1);
                    clist.push(subject);
                }
                console.log(clist);

                const option = {
                    title: {
                        text: '成績統計圖'
                    },
                    tooltip: {
                        trigger: 'axis'
                    },
                    legend: {
                        data: clist
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    toolbox: {
                        feature: {
                            saveAsImage: {}
                        }
                    },
                    xAxis: {
                        type: 'category',
                        boundaryGap: false,
                        data: ['0-9', '10-19', '20-29', '30-39', '40-49', '50-59', '60-69', '70-79', '80-89', '90-99', '100']
                    },
                    yAxis: {
                        type: 'value'
                    },
                    series: [
                        {
                            name: clist[0],
                            type: 'line',
                            stack: 'Total',
                            data: [120, 132, 101, 134, 90, 230, 210]
                        },
                        {
                            name: clist[1],
                            type: 'line',
                            stack: 'Total',
                            data: [220, 182, 191, 234, 290, 330, 310]
                        },
                        {
                            name: clist[2],
                            type: 'line',
                            stack: 'Total',
                            data: [150, 232, 201, 154, 190, 330, 410]
                        },
                        {
                            name: clist[3],
                            type: 'line',
                            stack: 'Total',
                            data: [320, 332, 301, 334, 390, 330, 320]
                        },
                        {
                            name: clist[4],
                            type: 'line',
                            stack: 'Total',
                            data: [820, 932, 901, 934, 1290, 1330, 1320]
                        }
                    ]
                };
                myChart.setOption(option);
            }
        }
    </script>

    <script>
        function scoreAssign(data = 0) {
            if (data == 100) {
                return (10);
            } else if (data >= 90) {
                return (9);
            } else if (data >= 80) {
                return (8);
            } else if (data >= 70) {
                return (7);
            } else if (data >= 60) {
                return (6);
            } else if (data >= 50) {
                return (5);
            } else if (data >= 40) {
                return (4);
            } else if (data >= 30) {
                return (3);
            } else if (data >= 20) {
                return (2);
            } else if (data >= 10) {
                return (1);
            } else {
                return (0);
            }
        }
    </script>

</body>

</html>