<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="comlib.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"
        integrity="sha256-QvgynZibb2U53SsVu98NggJXYqwRL7tg3FeyfXvPOUY=" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

    </head>

<body>
    <table border="1" class="table table-bordered table-hover table-sm table-striped mt-5" style="text-align:center">
        <thead class="table-dark">
        <tr>
            <td colspan="10"><h3>學生成績測試資料產生</h3></td>
        </tr>
        <tr>
            <td>姓名</td>
            <td>國文</td>
            <td>英文</td>
            <td>數學</td>
            <td>計算機概論</td>
            <td>工廠實習</td>
            <td>微積分</td>
            <td>體育</td>
            <td>平均成績</td>
            <td>排名</td>
        </tr>
    </thead>
    <tbody id="scoreList">

    </tbody>
    </table>
    <hr>
    <div id="main" style="width:800px; height:600px;"></div>
    <hr>
    <div id="main1" style="width:800px; height:600px;"></div>
    <hr>
    <div id="main2" style="width:800px; height:600px;"></div>

    <script>
        var scoreSheet = new Array();
        var fail = new Array(0, 0, 0, 0, 0, 0, 0);
        //var rank = new Array();
        var avg = 0;
        var rank = 0;
        var rankArray = [];
        var statistics = new Array(); // 統計各科成績分布圖

        for (let i = 0; i < 7; i++) {
            statistics[i] = new Array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);
        }

        var scoreData = [];

        for (let i = 0; i < 30; i++) {
            scoreData = Array("Student" + (i + 1), rand(1, 100), rand(1, 100), rand(1, 100), rand(1, 100), rand(1, 100), rand(1, 100), rand(1, 100), avg, rank)
            let total = 0;
            scoreSheet.push(scoreData);

            // average
            let sum = 0;
            for (let j = 1; j < scoreData.length - 2; j++) {
                //console.log('i: ' + i + " j: " + j);
                //console.log(scoreSheet[i][j]);
                sum += scoreSheet[i][j];
                scoreSheet[i][scoreData.length - 2] = (sum / (scoreData.length - 3)).toFixed(2);
            }
            rankArray[i] = (sum / (scoreData.length - 3)).toFixed(2);

            //計算各科不及格人數
            for (let j = 1; j < 8; j++) {
                if (scoreSheet[i][j] < 60) {
                    fail[j - 1]++;
                }
                statistics[j - 1][scoreAssign(scoreSheet[i][j])]++;
                total = total + scoreSheet[i][j];

            }
        }
        //console.log(statistics);

        // ***RANKING*** *** indexOf***
        let tempArray = [];
        // 排序rankArray 大 to 小
        rankArray.sort(function (a, b) { return b - a; });


        for (let i = 0; i < 30; i++) {
            scoreSheet[i][9] = (rankArray.indexOf(scoreSheet[i][8]) + 1);
        }
        //console.log(scoreSheet);
        //console.log(fail);
        render();

        function render() {
            const scoreList = document.querySelector('#scoreList');

            for (let i = 0; i < 30; i++) {
                const tr = document.createElement('tr');

                for (let j = 0; j < 10; j++) {
                    const td = document.createElement('td');
                    td.textContent = scoreSheet[i][j];
                    if (j == 9) {
                        td.classList.add('rank');
                        td.style.color = "black"
                    }
                    tr.append(td);
                }
                scoreList.append(tr);
            }
            // set background-color
            const tds = document.querySelectorAll('td');
            for (let i = 0; i < tds.length; i++) {
                if (parseInt(tds[i].textContent) < 60) {
                    tds[i].style.color = "red";
                } else if (parseInt(tds[i].textContent) > 95) {
                    tds[i].style.color = "green";
                    tds[i].textContent = '*' + tds[i].textContent;
                    tds[i].style.fontWeight = "bolder";
                } else if (((parseInt(tds[i].textContent) > 90) && (parseInt(tds[i].textContent) < 95))) {
                    tds[i].style.color = "green";
                }
                // reset rank field's bgc
                const rankTd = document.querySelectorAll('.rank');
                for (let i = 0; i < 30; i++) {
                    rankTd[i].style.color = "black"
                }
            }

            // failed counts 
            const tr = document.createElement('tr');
            const td = document.createElement('td')
            td.textContent = '不及格人數';
            tr.append(td);

            for (let i = 0; i < 9; i++) {
                const td = document.createElement('td');
                if (i > 6) {
                    td.textContent = '---';
                    td.classList.add('none');
                } else {
                    td.textContent = fail[i];
                }
                tr.append(td);
            }
            scoreList.append(tr);
        }

        function scoreAssign(data = 0) {
            if (data == 100) {
                return (10);
            } else if (data >= 90) {
                return (9);
            } else if (data >= 80) {
                return (8);
            } else if (data >= 70) {
                return (7);
            } else if (data >= 60) {
                return (6);
            } else if (data >= 50) {
                return (5);
            } else if (data >= 40) {
                return (4);
            } else if (data >= 30) {
                return (3);
            } else if (data >= 20) {
                return (2);
            } else if (data >= 10) {
                return (1);
            } else {
                return (0);
            }
        }
        console.log('1.23' + '23');
        console.log(scoreSheet);

        // setting avg data array 
        let avgArrayStastic = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];

        for (let i = 0; i < 30; i++) {
            let avg = parseFloat(scoreSheet[i][8]);
            let assign = scoreAssign(avg);
            avgArrayStastic[assign]++;
        }
        console.log(avgArrayStastic);

    </script>



    <script>
        var myChart = echarts.init(document.getElementById('main'));
        var clist = ['國文', '英文', '數學', '計算機概論', '工廠實習', '微積分', '體育']
    </script>

    <script>
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('main'));

        // 指定图表的配置项和数据
        var option = {
            title: {
                text: '班級成績統計圖'
            },
            tooltip: {},
            legend: {
                data: ['不及格人數']
            },
            xAxis: {
                data: clist//['衬衫', '羊毛衫', '雪纺衫', '裤子', '高跟鞋', '袜子']
            },
            yAxis: {},
            series: [
                {
                    name: '不及格人數',
                    type: 'bar',
                    //data: [5, 20, 36, 10, 10, 20]
                    data: [{
                        value: fail[0],
                        itemStyle: { color: '#5470c6' }
                    }, {
                        value: fail[1],
                        itemStyle: { color: '#91cc75' }
                    }, {
                        value: fail[2],
                        itemStyle: { color: '#fac858' }
                    }, {
                        value: fail[3],
                        itemStyle: { color: '#eee666' }
                    }, {
                        value: fail[4],
                        itemStyle: { color: '#73c0de' }
                    }, {
                        value: fail[5],
                        itemStyle: { color: '#3ba272' }
                    }, {
                        value: fail[6],
                        itemStyle: { color: '#fc8452' }
                    }]
                }
            ]
        };
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
    </script>
    <hr>
    <script>
        var myChart = echarts.init(document.getElementById('main1'));
        var option1 = {
            title: {
                text: '各科成績分布圖'
            },
            tooltip: {
                trigger: 'axis'
            },
            legend: {
                //data: ['Email', 'Union Ads', 'Video Ads', 'Direct', 'Search Engine']
                data: clist
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            toolbox: {
                feature: {
                    saveAsImage: {}
                }
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: ['0-9', '10-19', '20-29', '30-39', '40-49', '50-59', '60-69', '70-79', '80-89', '90-99', '100']
            },
            yAxis: {

            },
            series: [
                {
                    name: clist[0],
                    type: 'line',
                    stack: 'Total',
                    data: statistics[0]
                },
                {
                    name: clist[1],
                    type: 'line',
                    stack: 'Total',
                    data: statistics[1]
                },
                {
                    name: clist[2],
                    type: 'line',
                    stack: 'Total',
                    data: statistics[2]
                },
                {
                    name: clist[3],
                    type: 'line',
                    stack: 'Total',
                    data: statistics[3]
                },
                {
                    name: clist[4],
                    type: 'line',
                    stack: 'Total',
                    data: statistics[4]
                },
                {
                    name: clist[5],
                    type: 'line',
                    stack: 'Total',
                    data: statistics[5]
                },
                {
                    name: clist[6],
                    type: 'line',
                    stack: 'Total',
                    data: statistics[6]
                }
            ]
        };
        myChart.setOption(option1);
    </script>
    <hr>
    <script>
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('main2'));

        // 指定图表的配置项和数据
        var option2 = {
            title: {
                text: '平均成績分布',
                subtext: '圓餅圖',
                left: 'center'
            },
            tooltip: {
                trigger: 'item'
            },
            legend: {
                orient: 'vertical',
                left: 'left'
            },
            series: [
                {
                    name: '平均成績',
                    type: 'pie',
                    radius: '50%',
                    data: [
                        { value: avgArrayStastic[0], name: '0-9分: ' + avgArrayStastic[0] + '人' },
                        { value: avgArrayStastic[1], name: '10-19分: ' + avgArrayStastic[1] + '人' },
                        { value: avgArrayStastic[2], name: '20-29分: ' + avgArrayStastic[2] + '人' },
                        { value: avgArrayStastic[3], name: '30-39分: ' + avgArrayStastic[3] + '人' },
                        { value: avgArrayStastic[4], name: '40-49分: ' + avgArrayStastic[4] + '人' },
                        { value: avgArrayStastic[5], name: '50-59分: ' + avgArrayStastic[5] + '人' },
                        { value: avgArrayStastic[6], name: '60-69分: ' + avgArrayStastic[6] + '人' },
                        { value: avgArrayStastic[7], name: '70-79分: ' + avgArrayStastic[7] + '人' },
                        { value: avgArrayStastic[8], name: '80-89分: ' + avgArrayStastic[8] + '人' },
                        { value: avgArrayStastic[9], name: '90-99分: ' + avgArrayStastic[9] + '人' },
                        { value: avgArrayStastic[10], name: '100分: ' + avgArrayStastic[10] + '人' },
                    ],
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option2);
    </script>
</body>

</html>